# Как склеивать коммиты
Сначала узнаем, сколько коммитов нужно склеить. Эта команда покажет, какие коммиты у вас прибавились по сравнению с веткой master:
```git cherry -v master```

А эта — сколько их:
```git cherry -v master | wc -l```

![Alt text](https://assets.htmlacademy.ru/img/blog/27/1_git_cherry.png)

Отлично, у меня 5 коммитов. Теперь я хочу переписать историю с момента HEAD~5, т.е. с того, что было 5 коммитов назад. Для этого я делаю так:
```git rebase -i HEAD~5```

флаг ```-i``` — значит в интерактивном режиме. У меня открывается такой файл:

![Alt text](https://assets.htmlacademy.ru/img/blog/27/2_git_rebase.png)

Тут список моих коммитов и большой комментарий о том, что я могу сделать. Из списка комманд видно, что мы можем использовать ```squash``` или ```fixup``` для того, чтобы склеить коммиты. Первый пригодится тогда, когда вы хотите изменить коммит-месседж, а второй — когда хотите использовать коммит-месседж первого. Итак, чтобы склеить все коммиты, я делаю вот так:

![Alt text](https://assets.htmlacademy.ru/img/blog/27/3_git_squash.png)

То есть я говорю гиту «используй первый коммит, а остальные приклей к нему». Потом я сохраняю файл и закрываю его. Гит склеивает коммиты и предлагает мне ввести коммит-месседж (показывает коммит-месседжи всех склеенных коммитов):

![Alt text](https://assets.htmlacademy.ru/img/blog/27/4_git_commit_messages.png)

Я хочу оставить только последний:

![Alt text](https://assets.htmlacademy.ru/img/blog/27/6_git_log.png)

Ура, остался один коммит с нужным сообщением.

Теперь нужно вашу работу отправить на ваш гит-сервер. Обычно вы делаете это с помощью ```git push```, но сейчас вам это не удастся:

![Alt text](https://assets.htmlacademy.ru/img/blog/27/6.1_git_push.png)

Это потому, что ваша локальная ветка и ветка на сервере отличаются. Причём не просто в локальной ветке есть некоторые коммиты, которых нет на сервере, но и старых коммитов нет. Ведь у вас теперь один новый коммит вместо всех прежних. Чтобы запушить на сервер все ваши изменения, несмотря на конфликт, запустите пуш с флагом ```--force```:
```git push --force```

![Alt text](https://assets.htmlacademy.ru/img/blog/27/6.2_git_push_force.png)
# Как автоматизировать ребейз

Обычно всё-таки нужно оставить коммит-месседж первого изменения, типа «Сверстал то-то», остальные коммиты — просто правки к нему. Число правок иногда доходит до 15, не очень удобно сидеть и писать везде squash. Можно сделать так, чтобы коммиты автоматически присквошивались к нужному, только для этого нужно их правильно коммитить. Предположим, вы поменяли файл и хотите закоммитить изменения как правку по ревью:

![Alt text](https://assets.htmlacademy.ru/img/blog/27/6.2_git_push_force.png)

Сначала надо узнать хеш коммита, к которому этот коммит является правкой. Воспользуемся уже знакомым ```cherry```:

![Alt text](https://assets.htmlacademy.ru/img/blog/27/8_git_cherry.png)

Ага, вот он наш хеш. А теперь следующий коммит обозначим правкой к этому:
```git commit --fixup <хеш нужного коммита>```

Необязательно в точности копировать весь хеш, достаточно первых 7 символов. Я обычно выделяю от начала и сколько выделится и копирую:

![Alt text](https://assets.htmlacademy.ru/img/blog/27/9_git_commit_fixup.png)

Изменения закоммитились с сообщением ```fixup! Сообщение того коммита```. Наша история теперь выглядит вот так:

![Alt text](https://assets.htmlacademy.ru/img/blog/27/11_git_cherry.png)

Отлично. А теперь склеим все эти коммиты. Только не вручную. Гит сделает это за нас:
```git rebase -i --autosquash HEAD~4```
И гит сам подставит слово ```fixup``` там, где нужно:

![Alt text](https://assets.htmlacademy.ru/img/blog/27/12_git_rebase_autosquash.png)

Просто сохраняем, и гит склеивает коммиты и использует коммит-месседж первого:

![Alt text](https://assets.htmlacademy.ru/img/blog/27/13_git_rebase_success.png)
